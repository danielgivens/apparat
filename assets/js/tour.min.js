function webglAvailable(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}var composer,glitchPass,afterimagePass,rgbParams,rgbPass,filmParams,filmPass,renderPass,copyPass,textMesh1,textMesh2,scrollTimeout,video,shaderTime=0;$scrolling=!1,$speed=0,$extra=106,factor=2;var font,group1=new THREE.Group,group2=new THREE.Group,$dir="up",fontLoader=new THREE.FontLoader;prevH=0;var lastPos,newPos,timer,delta,prevW=0,objects=[],vector=new THREE.Vector3,ww=$(document).width(),wh=$(document).height(),ww2=.5*ww,wh2=.5*wh;document.body.classList.add("loading");var scrollbar=Scrollbar.init($(document).find(".scroll")[0],{speed:.8,damping:.1,renderByPixels:!0,syncCallbacks:!0,continuousScrolling:!1,alwaysShowTracks:!1,overscrollEffect:!1});function Tunnel(e){var t;this.init(),this.createMesh(),pixelRatio=window.devicePixelRatio||1,(composer=new THREE.EffectComposer(this.renderer)).setSize($("#scene").width()*pixelRatio,$("#scene").height()*pixelRatio),composer.addPass(new THREE.RenderPass(this.scene,this.camera)),(glitchPass=new THREE.GlitchPass).renderToScreen=!1,composer.addPass(glitchPass),(afterimagePass=new THREE.AfterimagePass).renderToScreen=!0,composer.addPass(afterimagePass);var s=new THREE.MeshBasicMaterial({color:16777215});$(".layer").length,t=0,$(".layer").each(function(){if(string1=$(this).find("h1").find(".line-1").html(),string2=$(this).find("h1").find(".line-2").html(),string1&&string2){var o=new THREE.TextGeometry(string1,{font:e,size:3,height:1e-4,curveSegments:6});o.center();var r=new THREE.Mesh(o,s);i=t,r.position.setX(0).setY(18e-6*ww).setZ(-i),r.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww);var n=new THREE.TextGeometry(string2,{font:e,size:3,height:1e-4,curveSegments:6});n.center();var a=new THREE.Mesh(n,s);i=t,a.position.setX(0).setY(-18e-6*ww).setZ(-i),a.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww),group1.add(r),group2.add(a)}t++}),Scrollbar.get($(".scroll")[0]).scrollTo(0,$(".layer").eq(0).outerHeight()/4,2e3),(new THREE.Box3).setFromObject(group1).getCenter(group1.position).multiplyScalar(-1),group1.position.set(0,0,0),(new THREE.Box3).setFromObject(group1).getCenter(group2.position).multiplyScalar(-1),group2.position.set(0,0,0),this.scene.add(group1),this.scene.add(group2),this.handleEvents(),document.body.classList.remove("loading"),window.requestAnimationFrame(this.render.bind(this))}$scH=$(".scroll .scroll-content").height(),scrollbar.addListener(function(e){$scrolled=e.offset.y,$(".fixed").css("top",$scrolled+"px"),scrollbar.limit.x=0,$(".layer").each(function(){$(this).offset().top<0&&$(this).offset().top>-1*$(this).outerHeight()?($(this).addClass("current"),$cta=$(this).find(".content").html(),$cta?($(".cta").html($cta),$(this).find(".content").find("a").length>0?($(".hit").removeClass("hide"),$(".hit").attr("href",$(this).find(".content").find("a").attr("href"))):($(".hit").attr("href",$(this).find(".content").find("a").attr("href")),$(".hit").addClass("hide"))):$(".cta").html("")):$(this).removeClass("current")}),$scrolled>=$scH-1.1*wh&&scrollbar.setPosition(0,0),$dir=e.direction.y,$scrolling=!0,newPos=$scrolled,null!=lastPos&&(delta=newPos-lastPos),lastPos=newPos,$speed=delta,$speed<0&&($speed*=-1),clearTimeout(scrollTimeout),scrollTimeout=setTimeout(function(){$scrolling=!1},150)}),$(".info-toggle").click(function(e){if($("body").hasClass("show-info"))$("body").removeClass("show-info");else{if($(".info-panel .grid.dates *").length<=0?($scrollInfo=!0,$(".info-panel .grid.dates").html($(".scroll .vert .show").clone())):$scrollInfo=!1,$(".info-panel .grid.social *").length<=0?($scrollInfo=!0,$(".info-panel .grid.social").html($(".scroll .vert .social").clone())):$scrollInfo=!1,$scrollInfo){var t=Scrollbar.init($(document).find(".info-panel")[0],{speed:2,damping:.1,renderByPixels:!0,syncCallbacks:!0,continuousScrolling:!1,alwaysShowTracks:!1,overscrollEffect:!1});t.addListener(function(){t.limit.x=0})}$("body").addClass("show-info")}e.preventDefault()}),$jump=0,$(".vert .intro").click(function(e){e.preventDefault()}),$(document).keydown(function(e){switch(e.which){case 37:break;case 38:scrollbar.scrollIntoView($(document).find(".layer.current").prev(".layer")[0],{offsetLeft:0,offsetTop:-1*wh2,alignToTop:!0,onlyScrollIfNeeded:!0});break;case 39:break;case 40:$jump>$(".layer.show").length&&($jump=0),scrollbar.scrollIntoView($(document).find(".layer.current").next(".layer")[0],{offsetLeft:0,offsetTop:-1*wh2,alignToTop:!0,onlyScrollIfNeeded:!0}),$jump++;break;default:return}e.preventDefault()}),Tunnel.prototype.init=function(){this.speed=.005,this.mouse={position:new THREE.Vector2(0,0),target:new THREE.Vector2(0,0)},this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:document.querySelector("#scene")}),this.renderer.setSize(ww,wh),this.renderer.setClearColor(0),this.camera=new THREE.PerspectiveCamera(100,ww/wh,.01,wh),this.camera.position.z=0,this.scene=new THREE.Scene,this.scene.fog=new THREE.Fog(0,.01,3)},Tunnel.prototype.createMesh=function(){for(var e=[],t=0;t<15;t+=1)e.push(new THREE.Vector3(0,0,t/4*2.5));e[4].y=0,this.curve=new THREE.CatmullRomCurve3(e);var s=new THREE.Geometry;s.vertices=this.curve.getPoints(70),this.splineMesh=new THREE.Line(s,new THREE.LineBasicMaterial),this.tubeMaterial=new THREE.MeshBasicMaterial({side:THREE.BackSide,map:tunnelTexture,wireframe:!1}),this.tubeMaterial.map.wrapS=THREE.RepeatWrapping,this.tubeMaterial.map.wrapT=THREE.RepeatWrapping,this.tubeMaterial.map.repeat.set(1,1),this.tubeGeometry=new THREE.TubeGeometry(this.curve,70,.9,30,!1),this.tubeMaterial.map.needsUpdate=!0,this.tubeMesh=new THREE.Mesh(this.tubeGeometry,this.tubeMaterial),this.scene.add(this.tubeMesh),this.tubeGeometry_o=this.tubeGeometry.clone()},Tunnel.prototype.handleEvents=function(){window.addEventListener("resize",this.onResize.bind(this),!1)},Tunnel.prototype.onResize=function(){ww=$(document).width(),wh=$(document).height(),ww2=.5*ww,wh2=.5*wh,$scH=$(".scroll .scroll-content").height(),group1.traverse(function(e){e instanceof THREE.Mesh&&(e.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww),e.position.setY(18e-6*ww))}),group2.traverse(function(e){e instanceof THREE.Mesh&&(e.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww),e.position.setY(-18e-6*ww))}),factor=$(".layer").eq(0).outerHeight()/wh,this.camera.aspect=ww/wh,this.camera.updateProjectionMatrix(),this.renderer.setSize(ww,wh)},Tunnel.prototype.onMouseMove=function(e){this.mouse.target.x=(e.clientX-ww2)/ww2,this.mouse.target.y=(wh2-e.clientY)/wh2},Tunnel.prototype.onDeviceOrientationChange=function(){var e=this.deviceOrientation.getScreenAdjustedEuler();e.alpha>0&&e.beta<90&&(this.mouse.target.y=Math.max(-1,Math.min(1,(e.beta-20)/30)),this.mouse.target.x=-Math.max(-1,Math.min(1,e.gamma/30)))},Tunnel.prototype.updateCameraPosition=function(){this.mouse.position.x+=(this.mouse.target.x-this.mouse.position.x)/30,this.mouse.position.y+=(this.mouse.target.y-this.mouse.position.y)/30,this.camera.rotation.z=.2*this.mouse.position.x,this.camera.rotation.y=Math.PI-.06*this.mouse.position.x,this.camera.position.x=.015*this.mouse.position.x,this.camera.position.y=.015*-this.mouse.position.y},Tunnel.prototype.updateMaterialOffset=function(){"down"===$dir?(this.tubeMaterial.map.offset.x+=$speed/1e3,this.tubeMaterial.map.offset.y+=$speed/3e3):(this.tubeMaterial.map.offset.x-=$speed/1e3,this.tubeMaterial.map.offset.y-=$speed/3e3)},Tunnel.prototype.updateCurve=function(){for(var e=0,t=null,s=null,o=0,i=this.tubeGeometry.vertices.length;o<i;o+=1)t=this.tubeGeometry_o.vertices[o],s=this.tubeGeometry.vertices[o],e=Math.floor(o/30),s.x+=(t.x+this.splineMesh.geometry.vertices[e].x-s.x)/10,s.y+=(t.y+this.splineMesh.geometry.vertices[e].y-s.y)/5;this.tubeGeometry.verticesNeedUpdate=!0,this.curve.points[2].x=.1*-this.mouse.position.x,this.curve.points[4].x=.1*-this.mouse.position.x,this.curve.points[2].y=.1*this.mouse.position.y,this.splineMesh.geometry.verticesNeedUpdate=!0,this.splineMesh.geometry.vertices=this.curve.getPoints(70)},Tunnel.prototype.render=function(){this.updateMaterialOffset(),this.updateCameraPosition(),group1.position.setZ($scrolled/factor/wh),group2.position.setZ($scrolled/factor/wh),this.updateCurve(),composer.render(this.renderer),window.requestAnimationFrame(this.render.bind(this))},backgrounds=["assets/images/texture-tour-1.jpg","assets/images/texture-tour-2.jpg","assets/images/texture-tour-3.jpg","assets/images/texture-tour-4.jpg","assets/images/texture-tour-5.jpg","assets/images/texture-tour-6.jpg","assets/images/texture-tour-7.jpg","assets/images/texture-tour-8.jpg","assets/images/texture-tour-9.jpg","assets/images/texture-tour-10.jpg","assets/images/texture-tour-11.jpg","assets/images/texture-tour-12.jpg"];var randbg=backgrounds[Math.floor(Math.random()*backgrounds.length)];if(webglAvailable()){var loader=new THREE.TextureLoader;loader.crossOrigin="Anonymous",texture=new THREE.VideoTexture(video),loader.load(randbg,function(e){fontLoader.load("assets/fonts/Terminal%20Grotesque_Regular.json",function(t){window.tunnelTexture=e,ww=$(document).width(),wh=$(document).height(),ww2=.5*ww,wh2=.5*wh,$scH=$(".scroll .scroll-content").height(),factor=$(".layer").eq(0).outerHeight()/wh,setTimeout(function(){window.tunnel=new Tunnel(t),this.onResize},300)},function(e){},function(e){})})}else $("body").addClass("no-webgl");