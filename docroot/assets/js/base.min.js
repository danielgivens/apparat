function webglAvailable(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(a){return!1}}function Tunnel(a){this.init(),this.createMesh(),pixelRatio=window.devicePixelRatio||1,composer=new THREE.EffectComposer(this.renderer),composer.setSize($("#scene").width()*pixelRatio,$("#scene").height()*pixelRatio),composer.addPass(new THREE.RenderPass(this.scene,this.camera)),glitchPass=new THREE.GlitchPass,glitchPass.renderToScreen=!1,composer.addPass(glitchPass),afterimagePass=new THREE.AfterimagePass,afterimagePass.renderToScreen=!0,composer.addPass(afterimagePass);var b,c=new THREE.MeshBasicMaterial({color:16777215});$(".layer").length,b=0,$(".layer").each(function(){if(string1=$(this).find("h1").find(".line-1").html(),string2=$(this).find("h1").find(".line-2").html(),console.log(string1),string1&&string2){var d=new THREE.TextGeometry(string1,{font:a,size:3,height:1e-4,curveSegments:6});d.center();var e=new THREE.Mesh(d,c);i=b,e.position.setX(0).setY(18e-6*ww).setZ(-i),e.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww);var f=new THREE.TextGeometry(string2,{font:a,size:3,height:1e-4,curveSegments:6});f.center();var g=new THREE.Mesh(f,c);i=b,g.position.setX(0).setY(-18e-6*ww).setZ(-i),g.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww),group1.add(e),group2.add(g)}b++}),Scrollbar.get($(".scroll")[0]).scrollTo(0,$(".layer").eq(0).outerHeight()/4,2e3),(new THREE.Box3).setFromObject(group1).getCenter(group1.position).multiplyScalar(-1),group1.position.set(0,0,0),(new THREE.Box3).setFromObject(group1).getCenter(group2.position).multiplyScalar(-1),group2.position.set(0,0,0),this.scene.add(group1),this.scene.add(group2),this.handleEvents(),document.body.classList.remove("loading"),window.requestAnimationFrame(this.render.bind(this))}THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:.9}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:8e-4},angle:{value:0},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:2.5},distortion_y:{value:2.6},col_s:{value:.15}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.25);","float ys = floor(gl_FragCoord.y / 0.25);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 100.*amount*vec4(rand(vec2(xs * seed,ys * seed*5.))*0.0);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},THREE.AfterimageShader={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float damp;","uniform sampler2D tOld;","uniform sampler2D tNew;","varying vec2 vUv;","vec4 when_gt( vec4 x, float y ) {","return max( sign( x - y ), 0.0 );","}","void main() {","vec4 texelOld = texture2D( tOld, vUv );","vec4 texelNew = texture2D( tNew, vUv );","texelOld *= damp * when_gt( texelOld, 0.05 );","gl_FragColor = max(texelNew, texelOld);","}"].join("\n")};var composer,shaderTime=0,glitchPass,afterimagePass,renderPass,copyPass,rgbParams,rgbPass,filmParams,filmPass,renderPass,copyPass,textMesh1,textMesh2,scrollTimeout;$scrolling=!1,$speed=0,$extra=106,factor=2;var video,group1=new THREE.Group,group2=new THREE.Group,font,$dir="up",fontLoader=new THREE.FontLoader;prevH=0;var lastPos,newPos,timer,delta,prevW=0,objects=[],vector=new THREE.Vector3,ww=window.innerWidth,wh=window.innerHeight,ww2=.5*ww,wh2=.5*wh;document.body.classList.add("loading");var scrollbar=Scrollbar.init($(document).find(".scroll")[0],{speed:.8,damping:.1,renderByPixels:!0,syncCallbacks:!0,continuousScrolling:!1,alwaysShowTracks:!1,overscrollEffect:!1});$scH=$(".scroll .scroll-content").height(),scrollbar.addListener(function(a){$scrolled=a.offset.y,$(".fixed").css("top",$scrolled+"px"),scrollbar.limit.x=0,$(".layer").each(function(){$(this).offset().top<0&&$(this).offset().top>-1*$(this).outerHeight()?($(this).addClass("current"),$cta=$(this).find(".content").html(),$cta?($(".cta").html($cta),$(this).find(".content").find("a").length>0?($(".hit").removeClass("hide"),$(".hit").attr("href",$(this).find(".content").find("a").attr("href"))):($(".hit").attr("href",$(this).find(".content").find("a").attr("href")),$(".hit").addClass("hide"))):$(".cta").html("")):$(this).removeClass("current")}),$scrolled>=$scH-1.1*wh&&scrollbar.setPosition(0,0),$dir=a.direction.y,$scrolling=!0,newPos=$scrolled,null!=lastPos&&(delta=newPos-lastPos),lastPos=newPos,$speed=delta,$speed<0&&($speed*=-1),clearTimeout(scrollTimeout),scrollTimeout=setTimeout(function(){$scrolling=!1},150)}),$(".info-toggle").click(function(a){if($("body").hasClass("show-info"))$("body").removeClass("show-info");else{if($(".info-panel .grid.dates *").length<=0?($scrollInfo=!0,$(".info-panel .grid.dates").html($(".scroll .vert .show").clone())):$scrollInfo=!1,$(".info-panel .grid.social *").length<=0?($scrollInfo=!0,$(".info-panel .grid.social").html($(".scroll .vert .social").clone())):$scrollInfo=!1,$scrollInfo){var b=Scrollbar.init($(document).find(".info-panel")[0],{speed:2,damping:.1,renderByPixels:!0,syncCallbacks:!0,continuousScrolling:!1,alwaysShowTracks:!1,overscrollEffect:!1});b.addListener(function(){b.limit.x=0})}$("body").addClass("show-info")}a.preventDefault()}),$jump=0,$(".vert .intro").click(function(a){a.preventDefault()}),$(document).keydown(function(a){switch(a.which){case 37:break;case 38:scrollbar.scrollIntoView($(document).find(".layer.current").prev(".layer")[0],{offsetLeft:0,offsetTop:-1*wh2,alignToTop:!0,onlyScrollIfNeeded:!0});break;case 39:break;case 40:$jump>$(".layer.show").length&&($jump=0),scrollbar.scrollIntoView($(document).find(".layer.current").next(".layer")[0],{offsetLeft:0,offsetTop:-1*wh2,alignToTop:!0,onlyScrollIfNeeded:!0}),$jump++;break;default:return}a.preventDefault()}),Tunnel.prototype.init=function(){this.speed=.005,this.mouse={position:new THREE.Vector2(0,0),target:new THREE.Vector2(0,0)},this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:document.querySelector("#scene")}),this.renderer.setSize(ww,wh),this.renderer.setClearColor(0),this.camera=new THREE.PerspectiveCamera(100,ww/wh,.01,wh),this.camera.position.z=0,this.scene=new THREE.Scene,this.scene.fog=new THREE.Fog(0,.01,3)},Tunnel.prototype.createMesh=function(){for(var a=[],b=0;b<15;b+=1)a.push(new THREE.Vector3(0,0,b/4*2.5));a[4].y=0,this.curve=new THREE.CatmullRomCurve3(a);var c=new THREE.Geometry;c.vertices=this.curve.getPoints(70),this.splineMesh=new THREE.Line(c,new THREE.LineBasicMaterial),this.tubeMaterial=new THREE.MeshBasicMaterial({side:THREE.BackSide,map:tunnelTexture,wireframe:!1}),this.tubeMaterial.map.wrapS=THREE.RepeatWrapping,this.tubeMaterial.map.wrapT=THREE.RepeatWrapping,this.tubeMaterial.map.repeat.set(1,1),this.tubeGeometry=new THREE.TubeGeometry(this.curve,70,.9,30,!1),this.tubeMaterial.map.needsUpdate=!0,this.tubeMesh=new THREE.Mesh(this.tubeGeometry,this.tubeMaterial),this.scene.add(this.tubeMesh),this.tubeGeometry_o=this.tubeGeometry.clone()},Tunnel.prototype.handleEvents=function(){window.addEventListener("resize",this.onResize.bind(this),!1)},Tunnel.prototype.onResize=function(){ww=window.innerWidth,wh=window.innerHeight,ww2=.5*ww,wh2=.5*wh,$scH=$(".scroll .scroll-content").height(),group1.traverse(function(a){a instanceof THREE.Mesh&&(a.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww),a.position.setY(18e-6*ww))}),group2.traverse(function(a){a instanceof THREE.Mesh&&(a.scale.set(1e-5*ww*-1,1e-5*ww,1e-5*ww),a.position.setY(-18e-6*ww))}),factor=$(".layer").eq(0).outerHeight()/wh,this.camera.aspect=ww/wh,this.camera.updateProjectionMatrix(),this.renderer.setSize(ww,wh)},Tunnel.prototype.onMouseMove=function(a){this.mouse.target.x=(a.clientX-ww2)/ww2,this.mouse.target.y=(wh2-a.clientY)/wh2},Tunnel.prototype.onDeviceOrientationChange=function(){var a=this.deviceOrientation.getScreenAdjustedEuler();a.alpha>0&&a.beta<90&&(this.mouse.target.y=Math.max(-1,Math.min(1,(a.beta-20)/30)),this.mouse.target.x=-Math.max(-1,Math.min(1,a.gamma/30)))},Tunnel.prototype.updateCameraPosition=function(){this.mouse.position.x+=(this.mouse.target.x-this.mouse.position.x)/30,this.mouse.position.y+=(this.mouse.target.y-this.mouse.position.y)/30,this.camera.rotation.z=.2*this.mouse.position.x,this.camera.rotation.y=Math.PI-.06*this.mouse.position.x,this.camera.position.x=.015*this.mouse.position.x,this.camera.position.y=.015*-this.mouse.position.y},Tunnel.prototype.updateMaterialOffset=function(){"down"===$dir?(this.tubeMaterial.map.offset.x+=$speed/1e3,this.tubeMaterial.map.offset.y+=$speed/3e3):(this.tubeMaterial.map.offset.x-=$speed/1e3,this.tubeMaterial.map.offset.y-=$speed/3e3)},Tunnel.prototype.updateCurve=function(){for(var a=0,b=null,c=null,d=0,e=this.tubeGeometry.vertices.length;d<e;d+=1)b=this.tubeGeometry_o.vertices[d],c=this.tubeGeometry.vertices[d],a=Math.floor(d/30),c.x+=(b.x+this.splineMesh.geometry.vertices[a].x-c.x)/10,c.y+=(b.y+this.splineMesh.geometry.vertices[a].y-c.y)/5;this.tubeGeometry.verticesNeedUpdate=!0,this.curve.points[2].x=.1*-this.mouse.position.x,this.curve.points[4].x=.1*-this.mouse.position.x,this.curve.points[2].y=.1*this.mouse.position.y,this.splineMesh.geometry.verticesNeedUpdate=!0,this.splineMesh.geometry.vertices=this.curve.getPoints(70)},Tunnel.prototype.render=function(){this.updateMaterialOffset(),this.updateCameraPosition(),group1.position.setZ($scrolled/factor/wh),group2.position.setZ($scrolled/factor/wh),this.updateCurve(),composer.render(this.renderer),window.requestAnimationFrame(this.render.bind(this))},backgrounds=["/assets/images/texture-tour-1.jpg","/assets/images/texture-tour-2.jpg","/assets/images/texture-tour-3.jpg","/assets/images/texture-tour-4.jpg","/assets/images/texture-tour-5.jpg","/assets/images/texture-tour-6.jpg","/assets/images/texture-tour-7.jpg","/assets/images/texture-tour-8.jpg","/assets/images/texture-tour-9.jpg","/assets/images/texture-tour-10.jpg","/assets/images/texture-tour-11.jpg","/assets/images/texture-tour-12.jpg"];var randbg=backgrounds[Math.floor(Math.random()*backgrounds.length)];if(webglAvailable()){var loader=new THREE.TextureLoader;loader.crossOrigin="Anonymous",texture=new THREE.VideoTexture(video),loader.load(randbg,function(a){fontLoader.load("/assets/fonts/Terminal%20Grotesque_Regular.json",function(b){window.tunnelTexture=a,window.tunnel=new Tunnel(b)},function(a){},function(a){})})}else $("body").addClass("no-webgl");